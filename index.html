<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>柱状图排序</title>
		<style>
			*{
				margin: 0;
				padding: 0;
			}
			.box{
				position: relative;
				width: 950px;
				height: 330px;
				margin: 20px auto;
				border: 1px solid red;
				list-style: none;
			}
			li{
				position: absolute;
				bottom: 0;
				width: 50px;
				height: 60px;
				background-color: #16c116;
			}
			button{
				margin-left: 50px;
				width: 100px;
				height: 30px;
			}
			.act{
				background-color: brown;
			}
			.done{
				background-color: #e7d210;
			}
		</style>
	</head>
	<body>
		<ul class="box"></ul>
		<button>生成柱状图</button>
		<button>开始排序</button>
		
		<script type="text/javascript">
			var box = document.getElementsByClassName("box")[0];
			var btn1 = document.getElementsByTagName("button")[0];
			var btn2 = document.getElementsByTagName("button")[1];
			
			// btn1.onclick = initLi;		// 生成按钮 添加事件
			btn1.onclick = function (){
				this.innerText = "重新生成";
				initLi();
			}
			
			// 排序功能上线
			btn2.onclick = function (){
				var lis = box.children;		// 获取li对象的数组
				var i = 0;		// 每一圈的下标
				var n = 0;		// 计圈器
				var temp;
				// 因为for循环太快,缓动动画跟不上,所有在此使用定时器模仿for循环
				var timer = setInterval(function (){
					if(lis[i].offsetHeight > lis[i+1].offsetHeight){
						// 换位置		换left值,换节点位置   parentNode.insertBefore(a,b);
						// child.parentNode.removeChild(child);
						lis[i].parentNode.insertBefore(lis[i+1],lis[i]);
						temp = lis[i+1].offsetLeft;
						/* lis[i+1].style.left = lis[i].offsetLeft + "px";
						lis[i].style.left = temp + "px"; */
						
						slowlyMove(lis[i+1],lis[i].offsetLeft);
						slowlyMove(lis[i],temp);
					}
					i ++;		// 模仿循环中的 i++; 计数器
					if(i === lis.length -1 - n){
						lis[i].className = "done";
						n ++;
						i = 0;
						console.log("第" + n +"圈跑完了");
					}
					if(n === lis.length - 1){
						lis[0].className = "done";
						// 所有的循环都已结束
						console.log("all stop ...");
						clearInterval(timer);
					}
				},1000)
			}
			
			function slowlyMove(ele,target){
				clearInterval(ele.timer);
				addClass(ele,"act");
				ele.timer = setInterval(function (){
					var start = ele.offsetLeft;
					var step = (target - start) / 10;
					if(Math.abs(step) < 1){
						step = step > 0 ? 1 : -1;
					}
					if(start === target) {
						removeClass(ele,"act");
						clearInterval(ele.timer);
						return;
					}
					ele.style.left = start + step + "px";
				},17)
			}
			
			function addClass(ele){
				var classStr = ele.getAttribute("class");
				var oldArr;
				if(!classStr){
					oldArr = [];
				}else{
					oldArr = classStr.split(" ");
				}
				var index;
				for(var i = 1; i < arguments.length; i ++){
					index = oldArr.indexOf(arguments[i]);
					if(index === -1 && (typeof arguments[i] === "string")){
						oldArr.push(arguments[i]);
					}
				}
				classStr = oldArr.join(" ");
				ele.setAttribute("class",classStr);
			}
			
			function removeClass(ele){
				var classStr = ele.getAttribute("class");
				if(!classStr){
					return;
				}
				var oldArr = classStr.split(" ");
				var index;
				for(var i = 1; i < arguments.length; i ++){
					index = oldArr.indexOf(arguments[i]);
					if(index !== -1){
						oldArr.splice(index,1);
					}
				}
				classStr = oldArr.join(" ");
				ele.setAttribute("class",classStr);
			}
			
			/*
				回忆: 冒泡排序
				for(var j = 0; j < arr.length - 1; j ++){
					for(var i = 0; i < arr.length - 1 - j; i ++){
						if(arr[i] > arr[i+1]){
							var temp = arr[i+1];
							arr[i+1] = arr[i];
							arr[i] = temp;
						}
					}					
				}
			*/
			
			
			// 初始化li的函数
			function initLi(){
				// 1 - 10		1*29 - 10*28
				// 随机范围 Math.floor(Math.random()*length + min) * 28
				var hArr = [];
				var str = "";
				var l;
				for(var i = 0; i < 10; i ++){
					var h = Math.floor(Math.random()*10 + 1) * 28;
					// 判断生成的 高度 时候已经存在,不存在添加,存在重来
					if(hArr.indexOf(h) === -1){
						hArr.push(h);
					}else{
						i --;
					}
				}
				// <!-- <li style="left: xxxpx;height:xxxpx;"></li> -->
				// 每个li的间距是 40  li的宽度是 50
				for(var j = 0; j < hArr.length; j ++){
					j === 0 ? l = 40 : l += 90;
					str += '<li style="left: ' + l + 'px;height: ' + hArr[j] + 'px;"></li>';
				}
				box.innerHTML = str;
			}
		</script>
	</body>
</html>
